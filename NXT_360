//denna fil är tänkt som det program man kör innan roboten påbörjar någon av uppgift 1 eller 2.

// OnFwdSync - titta över denna !


//måste använda lokal variabel, samt 2 st variabler för att kunna jämföra old -> new
// ex. om old > new, värdet minskar, går åt rätt håll.
//om new > old, värdet ökar, stanna upp, och sväng roboten motsatt håll. Kontrollera sedan att värdet minskar som ovanstående.

// för 360. 

// måste jämföra ett statiskt värde och sensor värdet. while det görs, sväng

// så länge värdet minskar uppfylls villkoret. När sensors värde börjar öka, blir sensor current value == sensor prev value +1
// och då stannar while-loopen


// while(avstånd < SensorUS(IN_4)


// Eller sensorns värde < föregående sensorns värde


/*

while(SensorUS(IN_4)>70) //så länge avståndet till närmsta vägg är större än 70 cm, roterar roboten
 {
  OnRev(OUT_C, 45);
 }
  Off(OUT_C);
  Wait(1000);
  
  distance = SensorUS(IN_4) + 1;
  
  
  distance_new = SensorUS(IN_4);
  distance_old = SensorUS(IN_4);
  
  while(SensorUS(IN_4) < distance)
  {
   OnRev(OUT_C, 45); // Så länge sensorns värde minskar fortsätter roboten att svänga. 
   // När sensors värde plötsligt börjar öka, dvs roboten vinkelrätt mot väggen, så blir sensorns värde == sensorns värde +1,
   // och då uppfylls inte längre while loopen och roboten stannar.
  }
Off(OUT_C);
 Wait(1000);
  


*/



inline void turn_90_left(int pwr) //roterar roboten 90 grader åt vänster
{
 RotateMotor(OUT_C, pwr, 515);
}

inline void turn_90_right(int pwr) //roterar roboten 90 grader åt höger
{
 RotateMotor(OUT_C, -pwr, 515);
}

inline void drop_book() //startar motor för att släppa boken
{
 RotateMotor(OUT_B, 48, 75);
 RotateMotor(OUT_B, -10, 75);
}

inline void robot_wall_align_left()
{

}

inline void robot_wall_align_right()
{

}

task main()
{
 SetSensorLowspeed(IN_4); //?
 SetSensorTouch(IN_1); // IN_1 = VÄNSTER TOUCH-SENSOR
 SetSensorTouch(IN_3); // IN_3 = HÖGER TOUCH-SENSOR

 while(SensorUS(IN_4)>60) //så länge avståndet till närmsta vägg är större än 65 cm, roterar roboten
 {
  OnRev(OUT_C, 45);
 }
  Off(OUT_C);
  Wait(1000);
  // Kör framåt mot väggen tills trycksensorerna är intryckta
  while(SENSOR_1 == 0 && SENSOR_3 == 0)
  {
   OnFwdSync(OUT_AC, 50, -3);
  }
  Off(OUT_AC);

  // Om endast vänster sensor intryckt (roboten inte 90* vinkelrätt mot väggen)
  if(SENSOR_1 == 1 && SENSOR_3 == 0)
  {
   while(SENSOR_3 == 0)
   {
    OnFwd(OUT_C, 65);
   }
  }
  Off(OUT_C);

  // Om endast höger sensor intryckt (roboten inte 90* vinkelrätt mot väggen)
  if(SENSOR_1 == 0 && SENSOR_3 == 1)
  {
   while(SENSOR_1 == 0)
   {
    OnFwd(OUT_A, 65);
   }
  }
  Off(OUT_A);
  Wait(1000);

  // Om båda trycksensorer intryckta (roboten ÄR 90* vinkelrätt mot väggen)
  if(SENSOR_1 == 1 && SENSOR_3 == 1)
  {
   RotateMotorEx(OUT_AC, -50, 395, -1, true, true); //backa 15 cm
  }

  Wait(1000);
  RotateMotor(OUT_C, 40, 500);
  //turn_90_left(40); // Sväng sedan 90* åt vänster
  Off(OUT_C);
  Wait(2000);
  OnFwdSync(OUT_AC, 50, -1);
  Wait(1000);
  Off(OUT_AC);
  RotateMotorEx(OUT_AC, 50, 5334, -1, true, true); //kör 2.7 meter
  //RotateMotor(OUT_AC, 40, 5334);
  Wait(2000);
  drop_book(); // släpp sedan av boken

 }
